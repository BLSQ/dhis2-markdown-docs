# dhis2-markdown-docs
All of your favourite documents - in markdown format!

## Introduction

This is a provisional repository for testing the migration of DHIS2 documentation to commonmark format.

## Shortcomings

See below regarding updating and building; but bear in mind the following issues and shortcomings!


- The document generation pipeline below **does not** support chunked HTML - **ONLY FULL HTML** (this could be fixed by generating the docs _via_ Docbook!)
- "Asides" (NOTE, TIP, WARNING, etc.) currently all look the same (blockquote format), but we may be able to modify them in the pre-processing step to accommodate individual styling
- It is not clear if we can continue the Bibliography support that Docbook provided (or if we need to)

### Known Issues - to be fixed

- [ ] Intra- (and inter-) document links need updating to generate properly
- [ ] Section regarding documentation and Docbook needs rewrite (obviously)
- [ ] build environment needs improvement to allow easy generation on various platforms (but most developers will not need to build as they can see the expected output in a good markdown editor)
- [ ] in conjunction with previous point, the build script could be changed to a more robust build tool

## Updating the documents
This is the easy bit, and is all that most people have to do.

### Format and editing
The documents are maintained in "Commonmark" markdown format.

Editing documents is as simple as editing a text file. Many IDEs have markdown support, including live previews. For Linux and Windows, [ghostwriter](https://wereturtle.github.io/ghostwriter/) is a nice option; it is free and supports side-by-side preview and custom stylesheets.


### Structure

The documents are structured as follows:

```
<root>
└── src
    └── commonmark
        └── en
	        ├── dhis2_android_user_man.index
	        ├── dhis2_developer_manual.index
	        ├── dhis2_end_user_manual.index
	        ├── dhis2_implementation_guide.index
	        ├── dhis2_user_manual_en.index
	        ├── user_stories_book.index
	        ├── dhis2.css
	        ├── dhis2_pdf.css
	        ├── dhis2_template.html
	        ├── dhis2-logo-rgb-negative.png
	        └── content
	            ├── android
	            │   └── resources
	            │       └── images
	            ├── common
	            │   └── bookinfo.yaml
	            ├── developer
	            │   ├── resources
	            │   │   └── images
	            ├── implementation
	            │   ├── resources
	            │   │   └── images
	            │   ├── `resources
	            │   │   └── images
	            ├── stories
	            │   ├── resources
	            │   │   └── images
	            └── user
	                └── resources
	                    └── images


```

### Index files and INCLUDES

The `.index` files are the starting points for the master documents. They contain only `!INCLUDE` directives.

e.g. dhis2_android_user_man.index:
```
!INCLUDE "content/common/about-this-guide.cm"mouse
!INCLUDE "content/android/configure-dhis2-programs-to-work-on-android-apps.cm"
!INCLUDE "content/android/android-event-capture-app.cm"
!INCLUDE "content/android/android-aggregate-data-capture-app.cm"
!INCLUDE "content/android/android-tracker-capture-app.cm"
```

The `!INCLUDE` directives point to the "chapters" that are used to make up the manual. 

> NOTE:
> the `!INCLUDE` directives are not part of pure commonmark format, but are used in pre-processing to build the master documents. The particular format here is the one supported by markdown-pp out of the box, but we could change it to another "include" format if desired.

It is perfectly valid to use `!INCLUDE` directives in the sub-documents too, but currently the documents are split up at chapter level only.

### Adding Images

Image resources should be included inside a folder structure beginning with `resources/images/` relative to the document. e.g. for the chapter `content/android/android-event-capture-app.cm`, the images are somewhere under `content/android/resources/images/<rest-of-path>`. _The images will be collected under `resources/images/content/android/<rest-of-path>` relative to the master document, when the the files are pre-processed for generation._  



## Building documents

The documents are build in stages:

1. The documents are pre-processed with [markdown-pp](https://github.com/jreese/markdown-pp). This assembles all the included (eventually nested) files into a single master document in a temporary directory. This includes copying and adjusting the links to included images.
2. The final documentation (HTML and PDF formats) are generated with [pandoc](https://pandoc.org/); using [weasyprint](https://weasyprint.readthedocs.io/en/stable/#) as the PDF generation engine.
3. The chunked html versions are generated by post-processing the full versions; splitting sections at h2 level, and inserting them into a template.

In order to build:

- run the build.sh script:
```
./build.sh
```

> NOTE:
> The first time it is run, the build script will create a python virtual env and install the dependencies from the requirements.txt file. It will copy pandoc (v2.2.1), and install a "modified" version of markdown-pp; these are provided in the tools directory. This should work on Linux. The venv will then be activated to perform the rest of the build.

The generated files are placed in a `target` directory:

```
<root>
├── build.sh
├── README.md
├── requirements.txt
├── venv_setup
├── src
│   └── commonmark
│       └── en
│           .
│           .
│           .
├── target
│   └── commonmark
│       └── en
│           ├── android
│           │   ├── dhis2_android_user_man.pdf
│           │   └── html
│           ├── developer
│           │   ├── dhis2_developer_manual.pdf
│           │   └── html
│           ├── end-user
│           │   ├── dhis2_end_user_manual.pdf
│           │   └── html
│           ├── implementer
│           │   ├── dhis2_implementation_guide.pdf
│           │   └── html
│           ├── user
│           │   ├── dhis2_user_manual_en.pdf
│           │   └── html
│           └── user-stories
│               ├── html
│               └── user_stories_book.pdf
└── tools
    ├── pandoc
    ├── pandoc-citeproc
    └── python
        └── markdown-pp-master
            ├── images
            ├── LICENSE
            ├── makefile
            ├── MANIFEST.in
            ├── MarkdownPP
            ├── readme.md
            ├── readme.mdpp
            ├── setup.py
            └── test


```

